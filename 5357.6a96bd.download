"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5357],{53897:function(e,t,s){s.d(t,{Z:function(){return a}});let a=(0,s(7170).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},84643:function(e,t,s){s.r(t),s.d(t,{default:function(){return E}});var a=s(52676),l=s(75271),o=s(43378),r=s(74926),i=s(31022),n=s(36551),d=s(38188),c=s(65819),u=s(87106),m=s(17112),p=s(25010),h=s(10328),g=s(53897);let v=(0,s(7170).Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);var f=s(65550),y=s(48958),x=s(37639),_=s(37766),b=s(17224),j=s(25994),N=s(54259),w=s(27976);let T=async e=>{try{let t=(0,N.a1)(),s=await fetch("".concat(w.XJ,"/threads/research/step"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"".concat(t)},body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));if(422===s.status)return{success:!1,error:e.message||"failed to validate params",code:s.status};return{success:!1,error:e.message||"failed to get research step",code:s.status}}let a=await s.json();return{success:!0,data:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"failed to get research step",code:500}}};var I=s(7717),S=s(52090),C=s(26152),Z=s(26449),k=s(48518),F=s(31063),A=s(60161),E=()=>{let e=(0,I.useTranslations)(),{template:t,templateQuery:s,isAgentPlanModalOpen:N,setAgentPlanModalOpen:w,closeAgentPlanModal:E}=(0,r.Z)(),{setTemplateData:M}=(0,k.Z)(),P=(0,i.Z)(e=>e.endSearch),O=_.Z.getState().homeFiles,U=(0,i.Z)(e=>e.isTopicReply),z=(0,i.Z)(e=>e.extensionSelected),D=(0,b.useRouter)(),G=_.Z.getState().homeImages;(0,I.useLocale)();let[J,q]=(0,l.useState)(!1),[H,Q]=(0,l.useState)([]),[V,B]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{var e;q(!!((null==t?void 0:t.params)&&(null==t?void 0:null===(e=t.params[0])||void 0===e?void 0:e.type)==="file"))}catch(e){console.log(e),q(!1)}},[t]);let R=(0,l.useMemo)(()=>!!t||z===n.Wh,[z,t]),X=(0,l.useMemo)(()=>_.Z.getState().homeFiles,[O]);(0,l.useEffect)(()=>{N&&(Q([]),R?Y():W())},[N]);let Y=async()=>{if(!t)return;if(!s.replace(/[\r\n]+/g," ").trim()){Q(t.sub_topics.map(e=>({content:e.title,source_type:e.source_type,source_id:e.source_id,source_info:e.source_info})));return}let{proSelected:a}=i.Z.getState(),l=a?n.NY:n.R_,o=localStorage.getItem(d.J.GTAG_EVENT_ACTIVATION)||c.ZP.getState().anonymousToken;B(!0);let r=await (0,u.GK)(t.short_id,{query:s,mode:l,device_id:o});if(!r||!r.data||!r.success){m.Z.error((null==r?void 0:r.error)||e("agent.load_template_failed")),B(!1);return}Q(r.data.sub_queries.map((e,s)=>{var a,l,o,r,i,n;return{content:e,source_type:(null===(l=t.sub_topics)||void 0===l?void 0:null===(a=l[s])||void 0===a?void 0:a.source_type)||"google",source_id:(null===(r=t.sub_topics)||void 0===r?void 0:null===(o=r[s])||void 0===o?void 0:o.source_id)||"",source_info:(null===(n=t.sub_topics)||void 0===n?void 0:null===(i=n[s])||void 0===i?void 0:i.source_info)||void 0}})),B(!1)},W=async()=>{if(!s)return;let{proSelected:t}=i.Z.getState(),a=t?n.NY:n.R_,l=localStorage.getItem(d.J.GTAG_EVENT_ACTIVATION)||c.ZP.getState().anonymousToken;B(!0);let o=await T({query:s,mode:a,device_id:l});if(!o||!o.data||!o.success){m.Z.error((null==o?void 0:o.error)||e("error.research_failed")),B(!1);return}Q(o.data.steps.map(e=>({content:e,source_type:n.gl,source_id:""}))),B(!1)},L=(e,t)=>{Q(H.map((s,a)=>a===e?{...s,content:t}:s))},K=(e,t)=>{Q(H.map((s,a)=>a===e?{...s,source_type:t.source_type,source_id:t.source_id,source_info:t.source_info}:s))},$=e=>{H.length<=1||Q(H.filter((t,s)=>s!==e))},ee=t=>{if(H.length>=j.o2){m.Z.warning(e("agent.max_steps_reached",{count:j.o2}));return}let s=[...H];s.splice(t+1,0,{content:"",source_type:n.gl,source_id:""}),Q(s)},et=()=>{E(),P(),Q([]),_.Z.getState().setIsGoToSearch(!1)},es=()=>{var e,a,l,o,i,d,c;let u={query:"",multiQuery:H.map(e=>({query:e.content,category:J?"chat_with_document":e.source_type||n.gl,source_id:e.source_id})),templateId:null===(e=r.Z.getState().template)||void 0===e?void 0:e.id};(null==X?void 0:null===(a=X.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===a?void 0:a.length)&&(u.category="chat_with_document",u.documents=null==X?void 0:null===(i=X.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===i?void 0:null===(o=i.map(e=>null==e?void 0:e.id))||void 0===o?void 0:o.join(",")),(null==G?void 0:null===(l=G.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===l?void 0:l.length)&&(u.category="chat_with_document",u.documents=null==G?void 0:null===(c=G.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===c?void 0:null===(d=c.map(e=>null==e?void 0:e.id))||void 0===d?void 0:d.join(",")),U&&(u.topicSource="topic"),M({templateQuery:s,template:t});let m=(0,x.M)(u);D.push(m),et(),(0,F.fk)((null==t?void 0:t.system)?A.U.AGENT_EXECUTE:A.U.AGENT_CREATE_EXECUTE,{value:1},!0)};return(0,a.jsx)(o.Vq,{open:N,onOpenChange:e=>{e&&w(e),e||et()},children:(0,a.jsxs)(o.cZ,{className:"max-w-3xl w-full p-0 overflow-visible",hideCloseButton:!0,"aria-describedby":void 0,children:[(0,a.jsx)(C.T,{children:(0,a.jsx)(S.$N,{children:e("agent.agent_query_steps")})}),(0,a.jsxs)("div",{className:"p-8 relative max-h-[90vh] overflow-y-auto scrollbar",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-8",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold bg-gradient-to-r from-blue-600 to-blue-400 bg-clip-text text-transparent",children:e("agent.agent_query_steps")}),(0,a.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:e("agent.agent_query_steps_tip")})]}),(0,a.jsxs)(p.z,{size:"sm",variant:"outline",disabled:V,onClick:()=>{if(H.length>=j.o2){m.Z.warning(e("agent.max_steps_reached",{count:j.o2}));return}Q([...H,{content:"",source_type:n.gl,source_id:""}])},className:"hover:bg-blue-50 dark:hover:bg-gray-600 transition-colors",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),e("agent.add_step")]})]}),V&&(0,a.jsx)("div",{className:"space-y-6",children:Array((null==t?void 0:t.sub_topics.length)||3).fill(0).map((e,t)=>(0,a.jsx)(f.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-10 rounded-lg bg-default-300"})},t))}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("div",{className:"space-y-6 relative",children:H.map((t,s)=>(0,a.jsxs)("div",{className:"flex items-center relative",children:[(0,a.jsx)("div",{className:"shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-medium shadow-md shadow-blue-100 dark:shadow-blue-600 transition-transform relative z-10",children:s+1}),s<H.length-1&&(0,a.jsx)("div",{className:"absolute left-4 top-8 w-[2px] h-[calc(100%+1rem)] bg-gradient-to-b from-blue-200 to-transparent -z-0"}),(0,a.jsxs)("div",{className:"ml-4 flex-1 flex items-center gap-2",children:[(0,a.jsx)(y.Y,{value:t.content,onValueChange:e=>L(s,e),placeholder:e("agent.input_step_content"),variant:"flat"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[!J&&(0,a.jsx)(Z.Z,{item:{title:t.content,source_type:t.source_type,source_id:t.source_id,source_info:t.source_info},onChange:K,index:s}),(0,a.jsx)(p.z,{size:"sm",variant:"ghost",onClick:()=>ee(s),className:"hover:bg-blue-50 dark:hover:bg-gray-600",disabled:H.length>=j.o2,children:(0,a.jsx)(h.Z,{className:"w-4 h-4 text-blue-500"})}),H.length>1&&(0,a.jsx)(p.z,{size:"sm",variant:"ghost",onClick:()=>$(s),className:"hover:bg-red-50 dark:hover:bg-gray-600",children:(0,a.jsx)(g.Z,{className:"w-4 h-4 text-red-500"})})]})]})]},s))})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,a.jsx)(p.z,{variant:"outline",className:"px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200",onClick:et,children:e("cancel")}),(0,a.jsxs)(p.z,{className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-md hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{V||es()},disabled:V||H.some(e=>!e.content.trim()),autoFocus:!0,children:[(0,a.jsx)(v,{className:"w-4 h-4 mr-1"}),e("execute")]})]})]})]})})}},74926:function(e,t,s){var a=s(36551),l=s(75910),o=s(98496);a.u_,a.eh;let r="agent-storage",i="agent-template-storage",n=()=>{try{let t=localStorage.getItem(r);if(t){var e;let s=JSON.parse(t);return(null===(e=s.state)||void 0===e?void 0:e.tempTemplates)||[]}}catch(e){console.error("Failed to parse stored templates:",e)}return[]},d=()=>{try{let t=sessionStorage.getItem(i);if(t){var e;let s=JSON.parse(t);return(null===(e=s.state)||void 0===e?void 0:e.template)||null}}catch(e){console.error("Failed to parse stored template:",e)}return null},c=(0,l.Ue)()((0,o.tJ)((0,o.tJ)(e=>({templateQuery:"",template:d(),isAgentPlanModalOpen:!1,tempTemplates:n(),setTemplate:t=>e(()=>({template:t})),clearTemplate:()=>e(()=>({template:null})),setAgentPlanModalOpen:t=>e(()=>({isAgentPlanModalOpen:t})),openAgentPlanModal:t=>e(()=>({templateQuery:t,isAgentPlanModalOpen:!0})),closeAgentPlanModal:()=>e(()=>({templateQuery:"",isAgentPlanModalOpen:!1})),addTempTemplate:t=>e(e=>({tempTemplates:[...e.tempTemplates,t]})),category:"",setCategory:t=>e({category:t})}),{name:i,storage:{getItem:async e=>{let t=window.sessionStorage.getItem(e);return{state:t?JSON.parse(t):null}},setItem:(e,t)=>{window.sessionStorage.setItem(e,JSON.stringify(t))},removeItem:e=>{window.sessionStorage.removeItem(e)}},partialize:e=>({template:e.template}),skipHydration:!0}),{name:r,partialize:e=>({tempTemplates:e.tempTemplates}),skipHydration:!0}));t.Z=c},37766:function(e,t,s){let a=(0,s(75910).Ue)((e,t)=>({homeFiles:[],setHomeFiles:t=>e(e=>({...e,homeFiles:t})),files:[],setFiles:t=>e(e=>({...e,files:t})),isUploading:!1,setIsUploading:t=>e({isUploading:t}),documents:[],setDocuments:t=>e({documents:t}),chatDocumentsCounts:0,setChatDocumentsCounts:t=>e({chatDocumentsCounts:t}),threadFiles:[],setThreadFiles:t=>e(e=>({...e,threadFiles:t})),currentFileProgress:0,setCurrentFileProgress:t=>e({currentFileProgress:t}),previousSearchCategory:null,setPreviousSearchCategory:t=>e({previousSearchCategory:t}),removeHomeFilesById:s=>{let a=t().homeFiles;e({homeFiles:[...null==a?void 0:a.filter(e=>!s.includes(e.id))]})},removeFilesById:s=>{let a=t().files;e({files:[...null==a?void 0:a.filter(e=>!s.includes(e.id))]})},nThUpload:0,setNThUpload:t=>e({nThUpload:t}),isImageUploading:!1,setIsImageUploading:t=>e({isImageUploading:t}),homeImages:[],setHomeImages:t=>e({homeImages:t}),threadImages:[],setThreadImages:t=>e({threadImages:t}),isOpenFirstUseModal:!1,setIsOpenFirstUseModal:t=>e({isOpenFirstUseModal:t}),removeHomeImageSById:s=>{let a=t().homeImages;e({homeImages:[...null==a?void 0:a.filter(e=>!s.includes(e.id))]})},homeImageSQustions:[],setHomeImagesQustions:t=>e({homeImageSQustions:t}),isImageChat:!0,setIsImageChat:t=>e({isImageChat:t}),isGoToSearch:!1,setIsGoToSearch:t=>e({isGoToSearch:t})}));t.Z=a},48518:function(e,t,s){let a=(0,s(75910).Ue)(e=>({currentData:void 0,templateData:void 0,setCurrentData:t=>e({currentData:t}),setTemplateData:t=>e({templateData:t}),clearCurrentData:()=>e({currentData:void 0}),clearTemplateData:()=>e({templateData:void 0})}));t.Z=a},48958:function(e,t,s){s.d(t,{Y:function(){return d}});var a=s(98945),l=s(83608),o=s(75271),r=s(82664),i=s(52676),n=(0,r.Gp)((e,t)=>{let{Component:s,label:r,description:n,isClearable:d,startContent:c,endContent:u,labelPlacement:m,hasHelper:p,isOutsideLeft:h,shouldLabelBeOutside:g,errorMessage:v,isInvalid:f,getBaseProps:y,getLabelProps:x,getInputProps:_,getInnerWrapperProps:b,getInputWrapperProps:j,getMainWrapperProps:N,getHelperWrapperProps:w,getDescriptionProps:T,getErrorMessageProps:I,getClearButtonProps:S}=(0,a.G)({...e,ref:t}),C=r?(0,i.jsx)("label",{...x(),children:r}):null,Z=(0,o.useMemo)(()=>d?(0,i.jsx)("span",{...S(),children:u||(0,i.jsx)(l.f,{})}):u,[d,S]),k=(0,o.useMemo)(()=>p?(0,i.jsx)("div",{...w(),children:f&&v?(0,i.jsx)("div",{...I(),children:v}):n?(0,i.jsx)("div",{...T(),children:n}):null}):null,[p,f,v,n,w,I,T]),F=(0,o.useMemo)(()=>(0,i.jsxs)("div",{...b(),children:[c,(0,i.jsx)("input",{..._()}),Z]}),[c,Z,_,b]),A=(0,o.useMemo)(()=>g?(0,i.jsxs)("div",{...N(),children:[(0,i.jsxs)("div",{...j(),children:[h?null:C,F]}),k]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{...j(),children:[C,F]}),k]}),[m,k,g,C,F,v,n,N,j,I,T]);return(0,i.jsxs)(s,{...y(),children:[h?C:null,A]})});n.displayName="NextUI.Input";var d=n},83608:function(e,t,s){s.d(t,{f:function(){return l}});var a=s(52676),l=e=>(0,a.jsx)("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 0 24 24",width:"1em",...e,children:(0,a.jsx)("path",{d:"M12 2a10 10 0 1010 10A10.016 10.016 0 0012 2zm3.36 12.3a.754.754 0 010 1.06.748.748 0 01-1.06 0l-2.3-2.3-2.3 2.3a.748.748 0 01-1.06 0 .754.754 0 010-1.06l2.3-2.3-2.3-2.3A.75.75 0 019.7 8.64l2.3 2.3 2.3-2.3a.75.75 0 011.06 1.06l-2.3 2.3z",fill:"currentColor"})})},56211:function(e,t,s){s.d(t,{S:function(){return i},T:function(){return n}});var a=s(79868),l=s(75271),o=s(93156);let r={border:0,clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"};function i(e={}){let{style:t,isFocusable:s}=e,[a,i]=(0,l.useState)(!1),{focusWithinProps:n}=(0,o.L)({isDisabled:!s,onFocusWithinChange:e=>i(e)}),d=(0,l.useMemo)(()=>a?t:t?{...r,...t}:r,[a]);return{visuallyHiddenProps:{...n,style:d}}}function n(e){let{children:t,elementType:s="div",isFocusable:o,style:r,...n}=e,{visuallyHiddenProps:d}=i(e);return l.createElement(s,(0,a.d)(n,d),t)}}}]);